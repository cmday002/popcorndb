# Spark ETL Configuration for PopcornDB
# Optimized for IMDb data processing with Iceberg

# Spark Application Configuration
spark.app.name                    IMDb-ETL
spark.master                      local[*]
spark.driver.memory               2g
spark.executor.memory             2g
spark.driver.maxResultSize        1g

# Iceberg Configuration
spark.sql.extensions              org.apache.iceberg.spark.extensions.IcebergSparkSessionExtensions
spark.sql.catalog.iceberg         org.apache.iceberg.spark.SparkCatalog
spark.sql.catalog.iceberg.type    hive
spark.sql.catalog.iceberg.uri     thrift://hive-metastore:9083
spark.sql.catalog.iceberg.warehouse /opt/data/warehouse

# Performance Optimizations
spark.sql.adaptive.enabled                    true
spark.sql.adaptive.coalescePartitions.enabled true
spark.sql.adaptive.skewJoin.enabled          true
spark.sql.adaptive.localShuffleReader.enabled true

# Memory and Shuffle Configuration
spark.sql.shuffle.partitions                  200
spark.sql.adaptive.advisoryPartitionSizeInBytes 128m
spark.sql.adaptive.coalescePartitions.minPartitionNum 1
spark.sql.adaptive.coalescePartitions.maxPartitionNum 100

# Serialization
spark.serializer                org.apache.spark.serializer.KryoSerializer
spark.kryo.registrationRequired false

# Logging
spark.eventLog.enabled          true
spark.eventLog.dir              /opt/spark/logs
